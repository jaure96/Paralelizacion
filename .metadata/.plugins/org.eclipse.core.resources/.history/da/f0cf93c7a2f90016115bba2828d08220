package p3calculodepiHilosForkJoin;

import java.util.ArrayList;
import java.util.List;
import java.util.concurrent.RecursiveTask;


public class PiCanculator extends RecursiveTask<Double>{
	
	double anchuraIntervalo;
	long inicio;
	long fin;
	
	public PiCanculator(double anchuraIntervalo, long inicio, long fin){
		this.anchuraIntervalo = anchuraIntervalo;
		this.inicio = inicio;
		this.fin = fin;	
	}
	@Override
	protected Double compute() {
		double valorPi = 0;
		int kont = 0;
		List<RecursiveTask<Double>> tareas = new ArrayList<>();
		
		while(fin <= Main.NUMINTERVALOS){
			if(kont <= Runtime.getRuntime().availableProcessors()){
				RecursiveTask<Double> nuevaTarea = new PiCanculator(anchuraIntervalo, inicio, fin);
				inicio += Main.TASKAMOUNT;
				fin += Main.TASKAMOUNT;
				tareas.add(nuevaTarea);
				nuevaTarea.fork();
				kont++;
			}else{
				calcularPi();
			}
			
		}
		for (RecursiveTask<Double> tarea: tareas){
			valorPi+= tarea.join();
		}
		return valorPi;		
	}
	
	private double calcularPi(){
		double valorPi = 0;
		double x;
		for (long i = inicio; i<fin; i++){
			x= (i+0.5)*anchuraIntervalo;
			valorPi += 4/(1+(x*x));
		}
		return valorPi;
	}

	
}
